# PPT 录音助手（Tkinter）

一个面向演示文稿的录音小工具：为每一页录音、可视化时长、设置整体时间限制，并在不变调的前提下按需加速，导出分段与合并音频，帮助你在有限时间内更高质量地讲解。

## 功能特性
- 多页管理：设置页数并为每页分别录音与播放（单按钮切换）。
- 时长可视化：列表显示“原时长”“加速时长”，录音中实时滚动更新。
- 目标时间限制：输入目标总时长，自动计算“每页平均上限”并在列表显示。
- 超标提示：有效时长（已处理优先）超过平均上限时，整行标红，直观提醒。
- 单页速度调整：支持单页速度设置（0.50–2.00），不变调时间伸缩。
- 导出模式：
  - 均匀加速导出：对“所有原始音频”统一加速到不超过目标总时长。
  - 当前状态导出：按“当前每页状态”（单页已处理优先）直接导出，不再做整体加速。

## 安装与运行
- 环境依赖：Python 3.9+（含 Tkinter）、麦克风设备可用。
- 安装依赖：
  ```bash
  python -m pip install -r requirements.txt
  ```
- 启动应用：
  ```bash
  python app.py
  ```

## 使用流程
1. 设置页数与目标总时长
   - 顶部输入“页数”“目标总时长（mm:ss）”，点击“生成”。
   - 列表会显示“平均上限”（目标总时长 ÷ 页数）。
2. 录音与播放
   - 在列表选中要录的页，点击“开始录音”（再次点击变为“停止录音”）。参见 `app.py:71` 与 `app.py:267`。
   - 录音完成后可“播放/停止播放”（单按钮切换）。参见 `app.py:75` 与 `app.py:277`。
3. 单页速度调整
   - 在右侧速度框设置倍速（0.50–2.00），点击“应用速度”，该页“加速时长”更新并参与总计。参见 `app.py:311`。
   - “恢复原速”移除该页处理音频，使“加速时长”恢复为“原时长”。参见 `app.py:336`。
4. 导出
   - “均匀加速导出”：统一按总时长与目标比值计算倍速，对原始音频加速并导出每页与合并音频。参见 `app.py:412`。
   - “当前状态导出”：按当前每页有效音频（单页已处理优先）直接导出。参见 `app.py:453`。

## 界面说明
- 列：`页码 | 平均上限 | 原时长 | 加速时长`。列定义见 `app.py:51`。
- 实时更新：录音中“原时长”滚动更新；未处理页“加速时长”同“原时长”。参见 `app.py:174`。
- 超标标记：以有效时长与平均上限比较，超过则整行标红。参见 `app.py:373`。
- 播放：优先播放处理后的音频，否则播放原始音频。参见 `app.py:224`。
- 删除：移除当前页音频与处理结果，行恢复为“未录制”。参见 `app.py:291`。

## 不变调时间伸缩
- 默认使用 `audiotsm` 的 WSOLA 算法处理语音，确保加速/减速不变调。参见 `app.py:94`。
- 若 WSOLA失败，回退到 `librosa.effects.time_stretch`；再失败时使用重采样降级（可能变调）。

## 导出结果
- 每页导出：`slide_#.wav`
- 合并导出：`combined.wav`
- 选择导出目录后，工具在该目录生成以上文件。

## 常见问题
- 麦克风权限（macOS）：首次录音需在“系统设置→隐私与安全→麦克风”允许 Python/终端访问。
- 播放错误（如 AUHAL -50）：关闭占用音频设备的应用，或切换到系统默认输入输出设备后重试。
- 依赖安装报错：确保使用虚拟环境，执行 `python -m pip install -r requirements.txt`。

## 技术参考
- 录音与播放：`sounddevice` + `soundfile`
- 时间伸缩：`audiotsm`（WSOLA），回退 `librosa`
- 桌面界面：`Tkinter` + `ttk`

## 代码入口与关键函数
- 应用入口：`app.py:476`
- UI构建：`app.py:34`
- 录音切换：`app.py:267`
- 播放切换：`app.py:277`
- WSOLA时间伸缩：`app.py:94`
- 单页速度应用：`app.py:311`
- 均匀加速导出：`app.py:412`
- 当前状态导出：`app.py:453`
- 超标标记与上限刷新：`app.py:373`
